## [2630 Memoize II 'Implicit-Trie'](https://leetcode.com/problems/memoize-ii/description/)

<!-- notecardId: 1767183738165 -->

```js
// - Time: O(k)
//    Cache hit: O(k)
//    Cache miss: O(k) + T(fn)
//
//    where:
//      k = args.length

// - Space: O(U * k)
//   where:
//      U = unique arguments
function memoize(fn) {
  const root = createNode();

  return function (...args) {
    let node = root;

    for (const arg of args) {
      const map = isObjectLike(arg) ? node.objects : node.primitives;

      if (!map.has(arg)) {
        map.set(arg, createNode());
      }

      node = map.get(arg);
    }

    if (node.hasValue) {
      return node.value;
    }

    const result = fn.apply(this, args);
    node.value = result;
    node.hasValue = true;

    return result;
  };
}

function createNode() {
  return {
    primitives: new Map(),
    objects: new WeakMap(),
    value: undefined,
    hasValue: false,
  };
}

function isObjectLike(it) {
  return typeof it === 'object' ? it !== null : typeof it === 'function';
}
```

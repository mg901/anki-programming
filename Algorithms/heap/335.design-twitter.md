## [355 Design Twitter](https://leetcode.com/problems/design-twitter/description/)

<!-- notecardId: 1743630030227 -->

```js
class Twitter {
  #count = 0;

  #tweetMap = new Map();

  #followeeMap = new Map();

  #feedLimit = 10;

  postTweet(userId, tweetId) {
    if (!this.#tweetMap.has(userId)) {
      this.#tweetMap.set(userId, []);
    }

    const tweetsById = this.#tweetMap.get(userId);

    tweetsById.push({
      count: this.#count,
      tweetId,
    });

    this.#count += 1;

    if (tweetsById.length > this.#feedLimit) {
      tweetsById.shift();
    }
  }

  getNewsFeed(userId) {
    const followeeIds = this.#followeeMap.get(userId) ?? new Set();
    followeeIds.add(userId);

    const maxHeap = new MaxPriorityQueue((x) => x.count);

    for (const followeeId of followeeIds) {
      if (!this.#tweetMap.has(followeeId)) continue;

      const tweetsById = this.#tweetMap.get(followeeId);
      const lastIndex = tweetsById.length - 1;

      maxHeap.enqueue({
        ...tweetsById[lastIndex],
        followeeId,
        index: lastIndex - 1,
      });
    }

    const feed = [];

    while (!maxHeap.isEmpty() && feed.length < this.#feedLimit) {
      const { tweetId, followeeId, index } = maxHeap.dequeue();
      feed.push(tweetId);

      if (index >= 0) {
        maxHeap.enqueue({
          ...this.#tweetMap.get(followeeId)[index],
          followeeId,
          index: index - 1,
        });
      }
    }

    return feed;
  }

  follow(followerId, followeeId) {
    if (!this.#followeeMap.has(followerId)) {
      this.#followeeMap.set(followerId, new Set());
    }
    this.#followeeMap.get(followerId).add(followeeId);
  }

  unfollow(followerId, followeeId) {
    this.#followeeMap.get(followerId)?.delete(followeeId);
  }
}
```
